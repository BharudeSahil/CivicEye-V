<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crime Rate Analysis by City (Year-wise)</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f9f9f9;
            color: #333;
        }
        h1 {
            text-align: center;
            margin-bottom: 20px;
        }
        .dropdown {
            margin-bottom: 30px;
            text-align: center;
        }
        .dropdown label {
            font-weight: bold;
            margin-right: 10px;
        }
        .dropdown select {
            padding: 8px;
            font-size: 14px;
            border-radius: 5px;
            border: 1px solid #ccc;
            background-color: #fff;
        }
        .chart-container {
            margin-bottom: 50px;
            padding: 20px;
            background: #fff;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }
        .chart-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }
        .chart-description {
            font-size: 14px;
            margin-bottom: 20px;
            color: #555;
        }
        .bar {
            opacity: 0.8;
            stroke: none; /* Remove stroke */ 
        }
        .bar:hover {
            opacity: 1;
        }
        .axis-label {
            font-size: 12px;
        }
        .legend rect {
            stroke-width: 1;
        }
        .line {
            stroke: #ccc;
            stroke-width: 0.5;
        }
        svg {
            font-size: 12px;
        }
    </style>
</head>
<body>
  <h1>Crime Rate Analysis by City</h1>
  <div class="dropdown">
    <label for="city-select">Select City:</label>
    <select id="city-select">
      <option value="Agra">Agra</option>
      <option value="Delhi">Delhi</option>
      <option value="Mumbai">Mumbai</option>
      <!-- Add more cities here -->
    </select>
  </div>
  <div id="charts-container"></div>

  <script>
    const cityData = {
      Agra: {
        violentCrimes: {
          2020: { attempt_murder: 4.6, culpable_homicide: 2, kidnapping: 9.8, murder: 4.4, riots: 12.9 },
          2021: { attempt_murder: 5.0, culpable_homicide: 2.5, kidnapping: 10.0, murder: 4.8, riots: 13.5 },
          2022: { attempt_murder: 4.2, culpable_homicide: 1.8, kidnapping: 9.2, murder: 4.0, riots: 12.0 },
        },
        propertyCrimes: {
          2020: { burglary: 15.0, theft: 25.0, robbery: 5.5 },
          2021: { burglary: 16.0, theft: 24.5, robbery: 6.0 },
          2022: { burglary: 14.5, theft: 23.0, robbery: 5.0 },
        },
        crimesAgainstWomen: {
          2020: { assault: 7.5, stalking: 3.2, harassment: 5.5 },
          2021: { assault: 8.0, stalking: 3.5, harassment: 6.0 },
          2022: { assault: 7.0, stalking: 3.0, harassment: 5.0 },
        },
        economicCrimes: {
          2020: { fraud: 10.5, embezzlement: 4.0, corruption: 3.5 },
          2021: { fraud: 11.0, embezzlement: 4.5, corruption: 4.0 },
          2022: { fraud: 9.5, embezzlement: 3.8, corruption: 3.2 },
        },
      },
      Delhi: {
        violentCrimes: {
          2020: { attempt_murder: 5.2, culpable_homicide: 1.8, kidnapping: 10.5, murder: 5.0, riots: 14.2 },
          2021: { attempt_murder: 5.5, culpable_homicide: 2.0, kidnapping: 11.0, murder: 5.2, riots: 15.0 },
          2022: { attempt_murder: 5.0, culpable_homicide: 1.6, kidnapping: 9.8, murder: 4.5, riots: 13.5 },
        },
        propertyCrimes: {
          2020: { burglary: 18.0, theft: 30.0, robbery: 7.0 },
          2021: { burglary: 17.5, theft: 29.0, robbery: 6.5 },
          2022: { burglary: 16.0, theft: 28.0, robbery: 6.0 },
        },
        crimesAgainstWomen: {
          2020: { assault: 8.0, stalking: 3.5, harassment: 6.0 },
          2021: { assault: 8.5, stalking: 4.0, harassment: 6.5 },
          2022: { assault: 7.8, stalking: 3.2, harassment: 5.8 },
        },
        economicCrimes: {
          2020: { fraud: 12.0, embezzlement: 5.0, corruption: 4.0 },
          2021: { fraud: 12.5, embezzlement: 5.2, corruption: 4.5 },
          2022: { fraud: 11.0, embezzlement: 4.8, corruption: 3.8 },
        },
      },
    };

    const margin = { top: 50, right: 20, bottom: 70, left: 50 };
    const width = 800 - margin.left - margin.right;
    const height = 400 - margin.top - margin.bottom;

    function createYearWiseChart(container, title, description, data, subCategories, colors) {
      const years = Object.keys(data);
      const x0 = d3.scaleBand().domain(years).range([0, width]).padding(0.2);
      const x1 = d3.scaleBand().domain(subCategories).range([0, x0.bandwidth()]).padding(0.05);
      const y = d3.scaleLinear().domain([0, d3.max(years.flatMap(year => Object.values(data[year])))]).nice().range([height, 0]);

      const chartContainer = d3.select(container)
        .append("div")
        .attr("class", "chart-container");

      chartContainer.append("div")
        .attr("class", "chart-title")
        .text(title);

      chartContainer.append("div")
        .attr("class", "chart-description")
        .text(description);

      const svg = chartContainer
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", `translate(${margin.left},${margin.top})`);

      svg.append("g")
        .attr("transform", `translate(0,${height})`)
        .call(d3.axisBottom(x0).tickSize(-height).tickFormat(d => d));

      svg.append("g")
        .call(d3.axisLeft(y).ticks(5).tickSize(-width));

      years.forEach(year => {
        svg.selectAll(`.bar-${year}`)
          .data(subCategories)
          .enter()
          .append("rect")
          .attr("class", `bar bar-${year}`)
          .attr("x", d => x0(year) + x1(d))
          .attr("y", d => y(data[year][d]))
          .attr("width", x1.bandwidth())
          .attr("height", d => height - y(data[year][d]))
          .attr("fill", d => colors[d]);
      });
    }

    function updateCharts(city) {
      const container = d3.select("#charts-container");
      container.html("");

      const categories = {
        violentCrimes: "Violent Crimes refer to crimes involving force or threat of force.",
        propertyCrimes: "Property Crimes involve burglary, theft, and robbery incidents.",
        crimesAgainstWomen: "Crimes Against Women include assault, stalking, and harassment cases.",
        economicCrimes: "Economic Crimes consist of fraud, embezzlement, and corruption activities.",
      };

      Object.keys(cityData[city]).forEach(crimeType => {
        const data = cityData[city][crimeType];
        createYearWiseChart(
          container.node(),
          crimeType.replace(/([A-Z])/g, ' $1').toUpperCase(),
          categories[crimeType],
          data,
          Object.keys(data[2020]),
          { burglary: "#FFD700", theft: "#87CEEB", robbery: "#FF4500", attempt_murder: "#89CFF0", culpable_homicide: "#A9A9A9", kidnapping: "#90EE90", murder: "#FFA07A", riots: "#B19CD9", assault: "#FFC0CB", stalking: "#FFA500", harassment: "#32CD32", fraud: "#1E90FF", embezzlement: "#8A2BE2", corruption: "#FF6347" }
        );
      });
    }

    d3.select("#city-select").on("change", function () {
      updateCharts(this.value);
    });

    updateCharts("Agra"); // Default city
  </script>
</body>
</html>
